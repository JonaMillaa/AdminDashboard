<mat-toolbar class="navbar">
  <mat-toolbar-row class="navbar-row">
    <h3>Total de usuarios en la app</h3>
    <div class="navbar-links">

      <div class="nav-item tutores">
        <mat-icon class="nav-icon">supervisor_account</mat-icon>
        <a class="nav-link">Tutores: {{ totalTutores }}</a>
      </div>
      <div class="nav-item estudiantes">
        <mat-icon class="nav-icon">school</mat-icon>
        <a class="nav-link">Estudiantes: {{ totalEstudiantes }}</a>
      </div>
    </div>
    <span class="spacer"></span>
    <div>
      <button class="btn" (click)="toggleContenido()">
        <i class="animation"></i>
        {{ mostrarContenido ? 'Ocultar Usuarios' : 'Mostrar Usuarios' }}
        <i class="animation"></i>
      </button>
    </div>
  </mat-toolbar-row>
</mat-toolbar>

<!-- Filtros de tiempo y gráficos -->
<div *ngIf="!mostrarContenido" class="charts">
  <div class="chart-container">
    <h2>Crecimiento de nuevos Usuarios</h2>
  <div class="chart-container">
     
    <h2>Crecimiento de nuevos Usuarios</h2>
  <div class="filtro-tiempo">
    <label for="filtroTiempoCrecimiento">Filtrar por:</label>
    <select id="filtroTiempoCrecimiento" [(ngModel)]="filtroTiempoCrecimiento" (change)="loadCrecimientoUsuariosData()">
      <option value="día">Día</option>
      <option value="mes">Mes</option>
    </select>
    <canvas id="crecimientoUsuariosChart"></canvas>
  </div>

  <div class="chart-container">

  </div>

  </div>

  <!-- Indicador de carga para Crecimiento de Usuarios -->
  <div *ngIf="cargandoCrecimientoUsuarios" class="no-data">
    <div class="spinner"></div>
    <p>Cargando datos gráfico...</p>
  </div>
    <canvas id="crecimientoUsuariosChart"></canvas>
  </div>

  <div class="chart-container">
    <!-- Indicador de carga para Inicios de Sesión -->
    <div *ngIf="cargandoLogins" class="no-data">
      <div class="spinner"></div>
      <p>Cargando datos gráfico...</p>
    </div>
    <h2>Historial de Inicios de Sesión por Fecha</h2>
    <label for="filtroTiempoLogins">Filtrar por:</label>
    <select id="filtroTiempoLogins" [(ngModel)]="filtroTiempoLogins" (change)="loadLoginsData()">
      <option value="día">Día</option>
      <option value="mes">Mes</option>
    </select>
    <canvas id="loginsChart"></canvas>
  </div>
</div>

<!-- Contenedor de gestión de usuarios, visible solo si mostrarContenido es true -->
<div *ngIf="mostrarContenido" class="content">
  <mat-tab-group>
    <mat-tab label="Todos">
      <div class="user-list">
        <mat-card *ngFor="let usuario of usuarios$ | async" class="user-card">
          <mat-card-header>
            <div mat-card-avatar class="avatar">
              <img [src]="usuario.Foto || '../../assets/images/user.png'" alt="" />
            </div>
            <mat-card-title>{{ usuario.Nombre }} {{ usuario.Apellido }}</mat-card-title>
            <mat-card-subtitle>{{ usuario.Rol }} - {{ usuario.Carrera }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Email:</strong> {{ usuario.Email }}</p>
            <p><strong>Teléfono:</strong> {{ usuario.Telefono }}</p>
            <p><strong>Estado:</strong> {{ usuario.Estado }}</p>
            <p><strong>Año de carrera:</strong> {{ usuario.Anio_carrera }}</p>
            <p><strong>Fecha de ingreso:</strong> {{ usuario.Fecha_ingreso }}</p>
            <p><strong>Comuna:</strong> {{ usuario.Direccion.Comuna }}</p>
            <p><strong>Región:</strong> {{ usuario.Direccion.Region }}</p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <mat-tab label="Tutores">
      <div class="user-list">
        <mat-card *ngFor="let tutor of tutores$ | async" class="user-card">
          <mat-card-header>
            <mat-card-title>{{ tutor.Nombre }} {{ tutor.Apellido }}</mat-card-title>
            <mat-card-subtitle>Tutor - {{ tutor.Carrera }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Email:</strong> {{ tutor.Email }}</p>
            <p><strong>Teléfono:</strong> {{ tutor.Telefono }}</p>
            <p><strong>Comuna:</strong> {{ tutor.Direccion.Comuna }}</p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <mat-tab label="Estudiantes">
      <div class="user-list">
        <mat-card *ngFor="let estudiante of estudiantes$ | async" class="user-card">
          <mat-card-header>
            <mat-card-title>{{ estudiante.Nombre }} {{ estudiante.Apellido }}</mat-card-title>
            <mat-card-subtitle>Estudiante - {{ estudiante.Carrera }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Email:</strong> {{ estudiante.Email }}</p>
            <p><strong>Año de carrera:</strong> {{ estudiante.Anio_carrera }}</p>
            <p><strong>Comuna:</strong> {{ estudiante.Direccion.Comuna }}</p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- Tabla de Ayudantías Finalizadas -->
<div *ngIf="!mostrarContenido">
  <div *ngIf="ayudantiasFinalizadas.length > 0" class="table-container">
    <h2>Detalles de Participación de Estudiantes en Ayudantías Finalizadas</h2>

    <table>
      <thead>
        <tr>
          <th>Nombre del Estudiante</th>
          <th>Apellido del Estudiante</th>
          <th>Título de la Ayudantía</th>
          <th>Descripción</th>
          <th>Categoría</th>
          <th>Subcategoría</th>
          <th>Fecha de Ayudantía</th>
          <th>Participantes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ayudantia of ayudantiasFinalizadas">
          <td>{{ ayudantia.nombre_estudiante }}</td>
          <td>{{ ayudantia.apellido_estudiante }}</td>
          <td>{{ ayudantia.titulo_ayudantia }}</td>
          <td>{{ ayudantia.descripcion_ayudantia }}</td>
          <td>{{ ayudantia.categoria }}</td>
          <td>{{ ayudantia.subcategoria }}</td>
          <td>{{ ayudantia.fecha_ayudantia }}</td>
          <td>{{ ayudantia.participantes }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div *ngIf="!ayudantiasFinalizadas.length" class="no-data">
  <div class="spinner"></div>
  <p *ngIf="ayudantiasFinalizadas.length === 0">Cargando datos...</p>
</div>
